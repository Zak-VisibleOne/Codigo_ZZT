<script>
    var dtMediaImageListing;
    jQuery(document).ready(function () {
        dtMediaImageListing = $('#dtMediaImageListing').dataTable({
            pageLength: 25,
            lengthMenu: [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, 'All']],
            columnDefs: [
                {
                    targets: [0], name: 'SrNo', className: 'center', sWidth: '10%',
                },
                {
                    targets: [1], name: 'Media', className: 'center', sWidth: '10%', orderable: false, render: function (data) {
                        return '<span class="badge badge-pill badge-secondary edit" style="font-size: 13px;">' + data + '</span>';
                    }
                },
                {
                    targets: [2], name: 'Image', className: 'center', sWidth: '20%', orderable: false, render: renderMediaImageListing
                },
                {
                    targets: [3], name: 'action', className: 'center', sWidth: '10%', orderable: false,
                    editor: { type: 'action', required: false, class: '' }, render: _RenderMediaButtom
                },
                {
                    targets: [4], name: 'ID', visible: false, sWidth: '0%'
                }
            ]
        });
        dtMediaImageListing.on('draw.dt', function () {
            $('#dtMediaImageListing .tooltips').tooltip();
        });
        dtMediaImageListing.on('click', '.preview', function (e) {
            e.preventDefault();
            var pos = dtMediaImageListing.fnGetPosition($(this).closest('tr')[0]);
            var data = dtMediaImageListing.fnGetData(pos);
            var mediaName = data[1];
            var img = data[2];
            $("#imgMediaPreview").attr('src', img);
            $('.imgtitle').text(mediaName);
            $('#PreviewMeidaImageModal').modal('show');
        });
        dtMediaImageListing.on('click', '.remove', function (e) {
            e.preventDefault();
            var pos = dtMediaImageListing.fnGetPosition($(this).closest('tr')[0]);
            var data = dtMediaImageListing.fnGetData(pos);
            var id = data[4];
            if (id) {
                //var approval = GetApproval();
                //if (approval.AllowDeleteMedia) {
                swal({
                    title: 'Are you sure?',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonClass: 'btn btn-success',
                    cancelButtonClass: 'btn btn-danger m-l-10',
                    confirmButtonText: 'Yes'
                }).then(function () {
                    DeleteMediaByID(id);
                })
                //}
                //else {
                //    toastr.error("System does not allow to remove media file!", "Warning");
                //}
            }
            else {
                toastr.warning("There is no data.", "Warning");
            }
        });
        loadMediaData();
    });
    function loadMediaData() {
        var data = GetMediaListing();
        dtMediaImageListing.api().clear().rows.add(data).draw();
    }
    function GetMediaListing() {
        var request = $.ajax({
            type: 'GET',
            dataType: 'json',
            async: false,
            url: "/Media/GetMediaImageListing",
            data: {
            },
            success: function (data) {
            }
        });
        var result = request.responseJSON;
        return (result.data != null) ? result.data : [];
    }
    $('#btnNewMedia').click(function () {
        clearMediaText();
        $('#MediaUpdateModal').modal('show');
    });
    function clearMediaText() {
        $('#methodMedia').val('add');
        $("#btnSaveUpdate_Media").prop('value', 'Save');
        $('#txtImageName_enUS').val('');
        $('#txtURL_enUS_Image').val('');
        $("#imgImage_enUS").attr('src', '/MediaFolder/sample.jpg');
        $('#hidlanguage').val('en-US');
    }
    function _RenderMediaButtom(data, type, row, meta) {
        return '<div class="button-items" style="text-align: center;">'
            + '<button type="button" class="btn btn-sm btn-outline-info waves-effect edit tooltips" title="Edit row content"><i class="fa fa-edit"></i> Edit</button>'
            + '<button type="button" class="btn btn-sm btn-outline-secondary waves-effect view tooltips" title="View row content"><i class="fa fa-edit"></i> View</button>'
            + '<button type="button" class="btn btn-sm btn-outline-danger waves-effect remove tooltips" title="Remove Row"><i class="fas fa-trash-alt"></i></button>'
            + '</div>';
    }
    function renderMediaImageListing(data) {
        return '<div style="width: 100px; height: 100px;display: flex;align-items: center;margin: 0 auto;">'
            + '<img src="' + data + '" alt="image" class="img-thumbnail preview" alt="100x100" width="100%" height="100%" data-holder-rendered="true"/>'
            + '</div> '
    }
    function onClick_CloseMediaUpdate() {
        clearMediaText();
        $('#MediaUpdateModal').modal('hide');
    }
    function onClick_SaveMediaData() {
        if (window.FormData !== undefined) {
            var fileUpload = $("#FileUpload_Image_enUS").get(0);
            var files = fileUpload.files;
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            var path = $('#currentBaseUrl').val();
            fileData.append('Media', 'Media');
            fileData.append('Path', path);
            $.ajax({
                url: "/Media/UploadMediaFile",
                type: "POST",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (result) {
                    if (result.result == "success") {
                        $("#hidContentType").val(result.data);
                        $("#hidLength").val(result.datalist[0]);
                        $("#txtImageName_enUS").val(result.datalist[1]);
                        $("#imgImage_enUS").attr('src', result.message);
                        $('#txtURL_enUS_Image').val(result.message);
                        $("#hidContentType").val(result.data.contentType);
                        //var path = result.data.url.split('~');
                        //var fullpath = path[path.length - 1];
                        $('#txtImageName_enUS').val(result.data.filename);
                        //$('#txtURL_enUS_Image').val(fullpath);
                        $("#hidLength").val(result.datalist[0]);
                        $("#txtImageName_enUS").val(result.datalist[1]);
                        $("#imgImage_enUS").attr('src', result.message);
                        $('#txtURL_enUS_Image').val(result.message);
                        //SaveData();
                        loadMediaData();
                        $('#MediaUpdateModal').modal('hide');
                    }
                    else {
                        toastr.warning(result.message, "Error");
                    }
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        } else {
            alert("FormData is not supported.");
        }
    }
    function DeleteMediaByID(ID) {
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '/Media/DeleteMediaByID',
            data: {
                MediaID: ID
            }, beforeSend: function () {
                return true;
            }, success: function (data) {
                var res = data.result;
                if (res.result == "success") {
                    swal(
                        'Deleted!', res.message, 'success'
                    )
                    loadMediaData();
                } else {
                    toastr.warning(res.message, "Error");
                }
            }, error: function (jqXHR, textStatus, errorThrown) {
                show_ajax_error(jqXHR, textStatus, errorThrown);
            }
        });
    }
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imgImage_enUS').attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
    }
    $("#FileUpload_Image_enUS").change(function () {
        readURL(this);
    });
    $("#MediaType").change(function () {
        var id = this.value;
        if (id == -1) {
            id = 0;
        }
        $('#hidID').val(id);
        //var rowCount = $('input[name="MediaFilterMediaUploaded"]:checked').val();
        //loadMediaData();
    });
</script>