<script>
    jQuery(document).ready(function () {
        GetDashboardColor();
        $('.themeDashboard').show();
        $('.themeTable').hide();
        $('.themeLogin').hide();
    });

    $('#themeDashboard').click(function (e) {
        $('.themeDashboard').show();
        $('.themeTable').hide();
        $('.themeLogin').hide();
    });
    $('#themeTable').click(function (e) {
        $('.themeDashboard').hide();
        $('.themeTable').show();
        $('.themeLogin').hide();
    });
    $('#themeLogin').click(function (e) {
        $('.themeDashboard').hide();
        $('.themeTable').hide();
        $('.themeLogin').show();
    });
    function getFileName(file) {
        var fullPath = file;
        if (fullPath) {
            var name = fullPath.split('\\');
            if (name) {
                return name[name.length - 1]
            }
        }
    }
    function getBase64Image(img) {
        var canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);
        var dataURL = canvas.toDataURL("image/png");
        return dataURL;
    }
    function base64ToFile(img, fileName) {
        var blobBin = atob(img.split(',')[1]);
        var array = [];
        for (var i = 0; i < blobBin.length; i++) {
            array.push(blobBin.charCodeAt(i));
        }
        var file = new File([new Uint8Array(array)], getFileName(fileName), { type: 'image/png' });
        return file;
    }
    function toDataURL(src, callback, outputFormat) {
        let image = new Image();
        image.crossOrigin = 'Anonymous';
        image.onload = function () {
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d');
            let dataURL;
            canvas.height = this.naturalHeight;
            canvas.width = this.naturalWidth;
            ctx.drawImage(this, 0, 0);
            dataURL = canvas.toDataURL(outputFormat);
            var file = base64ToFile(dataURL);
            callback(file);
        };
        image.src = src;
        if (image.complete || image.complete === undefined) {
            image.src = "data:image/gif;base64, R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
            image.src = src;
        }
    }
    function UpdateDashboardColor() {
        var fileName = $('#txtURL_LoginLogoImg').val();
        var loginLogoImg = document.getElementById('img_LoginLogoImg');
        var base64 = getBase64Image(loginLogoImg);
        var loginlogoImgFile = base64ToFile(base64, fileName);

        var dashboardFilename = $('#txtURL_DashboardLogo').val();
        var logoImg = document.getElementById('img_DashboardLogo');
        var base64 = getBase64Image(logoImg);
        var logoImgFile = base64ToFile(base64, dashboardFilename);
        var form = $('#globalConfig')[0];
        var data = new FormData(form);
        var color = $('#dashboardBackgroundColor').val();
        var logo = $('#txtURL_DashboardLogo').val();
        var logoImg = $('#img_DashboardLogo').attr('src');
        var tableBgColor = $('#tableBackgroundColor').val();
        var tableTitleColor = $('#tableTitleBackgroundColor').val();
        var menuHoverColor = $('#dashboardMenuHoverColor').val();
        var fontColor = $('#dashboardFontColor').val();
        var loginBgColor = $('#logoBackgroundColor').val();
        var loginLoginDesc = $('#logoDescription').val();
        data.append("BackgroundColor", color);
        data.append("LogoImage", getFileName(logoImg));
        data.append("LogoFile", logoImgFile);
        data.append("TableBgColor", tableBgColor);
        data.append("TableBgTitleColor", tableTitleColor);
        data.append("HoverColor", menuHoverColor);
        data.append("FontColor", fontColor);
        data.append("LoginBgColor", loginBgColor);
        data.append("LoginDescription", loginLoginDesc);
        data.append("LoginLogo", loginlogoImgFile);
        //$('#DashboardLogoImg').attr('src', dataUrl);
        SaveDashboardData(data);
    }
    function SaveDashboardData(data) {
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 800000,
            url: '/SystemManager/SaveDashboardSettings',
            beforeSend: function () {
                //$.blockUI({ boxed: true });
                return true;
            },
            success: function (data) {
                if (data.result == "success") {
                    toastr.success(data.message, "Save");
                } else {
                    toastr.error(data.message, "Error");
                }
            }
        });
    }
    function GetDashboardColor() {
        var color = $('#dashboardBackgroundColor').val();
        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/SystemManager/GetDashboardSettings',
            data: {
            },
            beforeSend: function () {
                //$.blockUI({ boxed: true });
                return true;
            },
            success: function (res) {
                if (res != null) {
                    var result = res.data;
                    $('#dashboardBackgroundColor').val(result.BackgroundColor);
                    //$('#colorPickerValue').css("background-color", result.BackgroundColor);
                    $('#tableBackgroundColor').val(result.TableBgColor);
                    $('#tableTitleBackgroundColor').val(result.TableBgTitleColor);
                    $('#dashboardMenuHoverColor').val(result.HoverColor);
                    $('#txtURL_DashboardLogo').val(result.LogoImage);
                    $('#tableBackgroundColor').val(result.TableBgColor);
                    $('#tableTitleBackgroundColor').val(result.TableBgTitleColor);
                    $('#img_DashboardLogo').attr('src', result.LogoImage);
                    $('#dashboardFontColor').val(result.FontColor);
                    $('#logoBackgroundColor').val(result.LoginBgColor);
                    $('#txtURL_LoginLogoImg').val(result.LoginLogo);
                    $('#logoDescription').val(result.LoginDescription);
                    $('#img_LoginLogoImg').attr('src', result.LoginLogo);
                }
                //$.unblockUI();
                //alert('save success');
                //  toastr.success("Save about us successfully.", "Save");
            }
        });
    }
    function onClickSetImage_DashboardLogo() {
        $('#ActiveTab').val("Dashboard");
        ShowSetImage();
    }
    function onClickSetImage_LogoImg() {
        $('#ActiveTab').val("loginLogo");
        ShowSetImage();
    }
</script>