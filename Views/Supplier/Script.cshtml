<script>
    var dtSup;
    jQuery(document).ready(function () {
        dtSup = $('#dtSup').dataTable({
            lengthMenu: [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, 'All']],
            columnDefs: [
                {
                    targets: [0], name: 'srno', className: 'center', orderable: true, sWidth: '5%',
                },
                {
                    targets: [1], name: 'name', className: 'left', sWidth: '10%', orderable: false, render: function (data) {
                        return '<span class="badge badge-pill badge-secondary edit" style="font-size: 13px;">' + data + '</span>';
                    }
                },
                {
                    targets: [2], name: 'tsp', className: 'center', orderable: true, sWidth: '5%',
                },
                {
                    targets: [3], name: 'action', className: 'left', sWidth: '10%', orderable: false,
                    editor: { type: 'action', required: false, class: '' }, render: _RenderContentButton
                },
                {
                    targets: [4], name: 'ID', className: 'left', visible: false, sWidth: '0%',
                }
            ]
        });
        dtSup.on('draw.dt', function () {
            $('#dtSup .tooltips').tooltip();
        });
        dtSup.on('click', '.edit', function (e) {
            e.preventDefault();
            var pos = dtSup.fnGetPosition($(this).closest('tr')[0]);
            var data = dtSup.fnGetData(pos);
            var id = data[4];
            edit(id);
        });
        dtSup.on('click', '.remove', function (e) {
            e.preventDefault();
            var pos = dtSup.fnGetPosition($(this).closest('tr')[0]);
            var data = dtSup.fnGetData(pos);
            var id = data[4];
            Delete(id);
        });
        Load();
        bindTspDDL();
        bindCtyDDL();
    });
    function bindTspDDL() {
        $.ajax({
            type: "GET",
            url: "/Supplier/getTsp",
            data: "{}",
            success: function (data) {
                var s = '<option value="-1">Select</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].TspId + '">' + data[i].TspName + '</option>';
                }
                $("#ddlTsp").html(s);
            }
        });
    }
    function bindCtyDDL() {
        $.ajax({
            type: "GET",
            url: "/Supplier/getCty",
            data: "{}",
            success: function (data) {
                var s = '<option value="-1">Select</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].CtyId + '">' + data[i].CtyName + '</option>';
                }
                $("#ddlCty").html(s);
            }
        });
    }
    function Load() {
        var data = GetData();
        dtSup.api().clear().rows.add(data).draw();
    }
    function GetData() {
        var request = $.ajax({
            type: 'GET',
            dataType: 'json',
            async: false,
            beforeSend: function () {
                return true;
            },
            url: "/Supplier/GetList",
            data: {
            }, success: function (data) {
            }
        });
        var result = request.responseJSON;
        return (result.data != null) ? result.data : [];
    }
    function edit(id) {
        $('#hidID').val(id);
        $('#method').val('edit');
        var data = GetDataByID(id);
        $("#txtSrNo").removeAttr("disabled");
        $('#txtSrNo').val(data.SrNo);
        $('#txtSupName').val(data.SupName);
        $('#ddlTsp').val(data.TspId);
        $('#ddlCty').val(data.CtyId);
        $('#txtAddress').val(data.Address1);
        $('#txtPhone').val(data.Phone1);
        $('#txtEmail').val(data.Email);
        $('#txtWebsite').val(data.WebSite);
        $('#SupModal').modal('show');
    }
    function GetDataByID(id) {
        var request = $.ajax({
            type: 'POST',
            dataType: 'json',
            async: false,
            beforeSend: function () {
                return true;
            },
            url: '/Supplier/GetDataByID',
            data: {
                ID: id
            }, success: function (data) {
            }, error: function (jqXHR, textStatus, errorThrown) {
                show_ajax_error(jqXHR, textStatus, errorThrown);
            }
        });
        var result = request.responseJSON;
        return (result.data != null) ? result.data : [];
    }
    function Delete(id) {
        swal({
            title: 'Are you sure?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonClass: 'btn btn-success',
            cancelButtonClass: 'btn btn-danger m-l-10',
            confirmButtonText: 'Yes'
        }).then(function () {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: '/Supplier/DeleteDataByID',
                data: {
                    ID: id
                }, beforeSend: function () {
                    return true;
                }, success: function (data) {
                    var res = data.result;
                    if (res.result == "success") {
                        toastr.success(res.message, "Success");
                        $('#SupModal').modal('hide');
                        Load();
                    } else {
                        toastr.warning(res.message, "Error");
                    }
                }, error: function (jqXHR, textStatus, errorThrown) {
                    show_ajax_error(jqXHR, textStatus, errorThrown);
                }
            });
        })
    }
    function AddNew() {
        $('#hidID').val('');
        $("#txtSrNo").attr("disabled", "disabled");
        $('#txtSrNo').val('');
        $('#txtSupName').val('');
        $('#ddlGender').val('');
        $('#ddlTsp').val('');
        $('#ddlCty').val('');
        $('#txtAddress').val('');
        $('#txtPhone').val('');
        $('#txtEmail').val('');
        $('#txtWebsite').val('');
        $('#method').val('add');
        $('#SupModal').modal('show');
    }
    function multipleDelete() {
        var Arr = new Array();
        $('input:checkbox[name=chkTable]:checked').each(function () {
            depArr.push($(this).val())
        })
        var obj = {
            Ids: Arr
        };
        swal({
            title: 'Are you sure?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonClass: 'btn btn-success',
            cancelButtonClass: 'btn btn-danger m-l-10',
            confirmButtonText: 'Yes'
        }).then(function () {
            $.ajax({
                url: '/Supplier/DeleteMultiple',
                contentType: 'application/json; charset=utf-8',
                type: 'POST',
                data: JSON.stringify(obj),
                cache: false,
                success: function (data) {
                    var res = data.result;
                    if (res.result == "success") {
                        toastr.success(res.message, "Info");
                        Load();
                    }
                    else {
                        toastr.warning(res.message, "Error");
                    }
                },
                error: function (xhr, status, error) {
                    toastr.warning(res.message, "Error");
                }
            });
        })
    }
    function save() {
        var id = $('#hidID').val();
        var srno = $('#txtSrNo').val();
        var name = $('#txtSupName').val();
        var gender = $('#ddlGender').val();
        var tsp = $('#ddlTsp').val();
        var cty = $('#ddlCty').val();
        var address = $('#txtAddress').val();
        var phone = $('#txtPhone').val();
        var email = $('#txtEmail').val();
        var website = $('#txtWebsite').val();
        var method = $('#method').val();
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: "/Supplier/SaveUpdate",
            data: {
                SupId: id,
                SrNo: srno,
                SupName: name,
                CtyId: cty,
                TspId: tsp,
                Address1: address,
                Gender: gender,
                Phone1: phone,
                Email: email,
                Website: website,
                Method: method
            }, success: function (data) {
                var res = data.result;
                if (res.result == "success") {
                    toastr.success(res.message, "Info");
                    $('#SupModal').modal('hide');
                    Load();
                }
                else {
                    toastr.warning(res.message, "Error");
                }
            }
        });
    }
</script>